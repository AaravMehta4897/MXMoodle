define(["jquery","core/ajax","core/str","core/notification","local_mxschool/locallib"],function(a,b,c,d,e){function f(){var b=a(".mx-form select#id_passengers").parent().parent(),c=a(".mx-form select#id_driver").parent().parent(),d=a(".mx-form input#id_type_other").parent().parent();a(".mx-form input#id_type_select_Driver").prop("checked")||(b.hide(),b.next().hide()),a(".mx-form input#id_type_select_Passenger").prop("checked")?(c.prev().show(),c.show()):(c.prev().hide(),c.hide()),a(".mx-form input#id_type_select_Other").prop("checked")?d.show():d.hide();var e=a(".mx-form input#id_type_select_Passenger").prop("checked");a(".mx-form input#id_destination").prop("disabled",e),a(".mx-form select#id_departure_time_hour").prop("disabled",e),a(".mx-form select#id_departure_time_minute").prop("disabled",e),a(".mx-form select#id_departure_time_ampm").prop("disabled",e)}function g(){var c=b.call([{methodname:"local_mxschool_get_esignout_student_options",args:{userid:a(".mx-form select#id_student").val()}}]);c[0].done(function(b){e.updateRadio(a('.mx-form div[data-groupname="type_select"] input'),b.types);var c=a(".mx-form select#id_passengers").parent().parent();a(".mx-form input#id_type_select_Driver").prop("checked")&&(b.maydrivepassengers?(c.show(),c.next().hide()):(c.hide(),c.next().show()));var d=a(".mx-form fieldset#id_permissions");if(a(".mx-form input#id_type_select_Passenger").prop("checked")&&"Any Driver"!==b.mayridewith){d.next().hide(),d.show();var f=d.children().eq(1).children().eq(0),g=d.children().eq(1).children().eq(1);if("Parent Permission"===b.mayridewith)f.show(),g.hide();else if("Specific Drivers"===b.mayridewith){f.hide();var h=g.children().eq(1).children().eq(0);h.contents().slice(1).remove(),h.append(b.specificdrivers),g.show()}}else d.next().show(),d.hide();e.updateMultiSelect(a(".mx-form select#id_passengers"),b.passengers),e.updateSelect(a(".mx-form select#id_driver"),b.drivers)}).fail(d.exception)}function h(){var c=b.call([{methodname:"local_mxschool_get_esignout_driver_details",args:{esignoutid:a(".mx-form select#id_driver").val()}}]);c[0].done(function(b){a(".mx-form input#id_destination").val(b.destination),a(".mx-form select#id_departure_time_hour").val(b.departurehour),a(".mx-form select#id_departure_time_minute").val(b.departureminute),a(".mx-form select#id_departure_time_ampm").val(b.departureampm?1:0)}).fail(function(){a(".mx-form input#id_destination").val(function(){return this.defaultValue}),a(".mx-form select#id_departure_time_hour > option").prop("selected",function(){return this.defaultSelected}),a(".mx-form select#id_departure_time_minute > option").prop("selected",function(){return this.defaultSelected}),a(".mx-form select#id_departure_time_ampm > option").prop("selected",function(){return this.defaultSelected})})}return function(){a(document).ready(function(){f(),g(),h()}),a(".mx-form select#id_student").change(g),a('.mx-form div[data-groupname="type_select"]').change(function(){f(),g()}),a(".mx-form select#id_driver").change(h)}});