define(["jquery","core/ajax","core/str","core/notification","local_mxschool/locallib"],function(a,b,c,d,e){function f(){var b=a(".mx-form select#id_passengers").parent().parent(),c=a(".mx-form select#id_driver").parent().parent(),d=a(".mx-form input#id_type_other").parent().parent();a(".mx-form input#id_type_select_Driver").prop("checked")||(b.hide(),b.next().hide()),a(".mx-form input#id_type_select_Passenger").prop("checked")?(c.prev().show(),c.show()):(c.prev().hide(),c.hide()),a(".mx-form input#id_type_select_Other").prop("checked")?d.show():d.hide();var e=a(".mx-form input#id_type_select_Passenger").prop("checked");a(".mx-form input#id_destination").prop("disabled",e),a(".mx-form select#id_departure_time_hour").prop("disabled",e),a(".mx-form select#id_departure_time_minute").prop("disabled",e),a(".mx-form select#id_departure_time_ampm").prop("disabled",e)}function g(){var f=b.call([{methodname:"local_mxschool_get_esignout_student_options",args:{userid:a(".mx-form select#id_student").val()}}]);f[0].done(function(b){e.updateRadio(a('.mx-form div[data-groupname="type_select"] input'),b.types);var d=a(".mx-form select#id_passengers").parent().parent();a(".mx-form input#id_type_select_Driver").prop("checked")&&(b.maydrivepassengers?(d.show(),d.next().hide()):(d.hide(),d.next().show()));var f=a(".mx-form fieldset#id_permissions");if(a(".mx-form input#id_type_select_Passenger").prop("checked")&&"Any Driver"!==b.mayridewith){f.next().hide(),f.show();var g=f.children().eq(1).children().eq(0),h=f.children().eq(1).children().eq(1);if("Parent Permission"===b.mayridewith)g.show(),h.hide();else if("Specific Drivers"===b.mayridewith){g.hide();var i=h.children().eq(1).children().eq(0);i.contents().slice(1).remove(),i.append(b.specificdrivers),h.show()}}else f.next().show(),f.hide();e.updateMultiSelect(a(".mx-form select#id_passengers"),b.passengers),a.when(c.get_string("form_select_default","local_mxschool")).done(function(c){b.drivers.unshift({value:0,text:c}),e.updateSelect(a(".mx-form select#id_driver"),b.drivers,!0)})}).fail(d.exception)}function h(){var c=b.call([{methodname:"local_mxschool_get_esignout_driver_details",args:{esignoutid:a(".mx-form select#id_driver").val()}}]);c[0].done(function(b){a(".mx-form input#id_destination").val(b.destination),a(".mx-form select#id_departure_time_hour").val(b.departurehour),a(".mx-form select#id_departure_time_minute").val(b.departureminute),a(".mx-form select#id_departure_time_ampm").val(b.departureampm?1:0)}).fail(function(){a(".mx-form input#id_destination").val(function(){return this.defaultValue}),a(".mx-form select#id_departure_time_hour > option").prop("selected",function(){return this.defaultSelected}),a(".mx-form select#id_departure_time_minute > option").prop("selected",function(){return this.defaultSelected}),a(".mx-form select#id_departure_time_ampm > option").prop("selected",function(){return this.defaultSelected})})}return function(){a(document).ready(function(){f(),g(),h()}),a(".mx-form select#id_student").change(g),a('.mx-form div[data-groupname="type_select"]').change(function(){f(),g()}),a(".mx-form select#id_driver").change(h)}});