define(["jquery","core/ajax","core/str","core/notification"],function(a,b,c,d){function e(){var e=a(".mx-form select#id_passengers").parent().parent(),f=a(".mx-form select#id_driver").parent().parent(),g=a(".mx-form input#id_type_other").parent().parent(),h=a(".mx-form fieldset#id_permissions");a(".mx-form input#id_type_select_Driver").prop("checked")||(e.hide(),e.next().hide()),a(".mx-form input#id_type_select_Passenger").prop("checked")?f.show():f.hide(),a(".mx-form input#id_type_select_Other").prop("checked")?g.show():g.hide();var i=b.call([{methodname:"local_mxschool_get_esignout_student_options",args:{userid:a(".mx-form select#id_student").val()}}]);i[0].done(function(b){var d=a('.mx-form div[data-groupname="type_select"] input');if(d.each(function(){var c=a(this),d=c.parent().parent().contents();b.types.includes(c.val())?(c.parent().show(),d.eq(d.index(c.parent())+3).get(0).nodeValue="â€ƒ"):(c.prop("checked")&&(c.prop("checked",!1),c.change()),c.parent().hide(),d.eq(d.index(c.parent())+3).get(0).nodeValue="")}),a(".mx-form input#id_type_select_Driver").prop("checked")&&(b.maydrivepassengers?(e.show(),e.next().hide()):(e.hide(),e.next().show())),a(".mx-form input#id_type_select_Passenger").prop("checked")&&"Any Driver"!==b.mayridewith){h.prev().hide(),h.show();var f=h.children().eq(1).children().eq(0),g=h.children().eq(1).children().eq(1);"Parent Permission"===b.mayridewith?(f.show(),g.hide()):"Specific Drivers"===b.mayridewith&&(f.hide(),a.when(c.get_string("esignout_form_specific_warning","local_mxschool")).done(function(a){g.children().eq(1).children().eq(0).text(a+" "+b.specificdrivers+"."),g.show()}))}else h.prev().show(),h.hide();var i=a(".mx-form select#id_passengers"),j=i.val();i.empty(),a.each(b.passengers,function(b,c){i.append(a("<option></option>").attr("value",c.userid).text(c.name))});var k=[];a.each(j,function(b,c){a(".mx-form select#id_passengers > option[value="+c+"]").length&&k.push(c)}),k.length&&i.val(k),j.toString()!==k.toString()&&i.change();var l=a(".mx-form select#id_driver"),m=l.val();l.empty(),a.each(b.drivers,function(b,c){l.append(a("<option></option>").attr("value",c.esignoutid).text(c.name))}),a(".mx-form select#id_driver > option[value="+m+"]").length?l.val(m):l.change();var n=a(".mx-form input#id_type_select_Passenger").prop("checked");a(".mx-form input#id_destination").prop("disabled",n),a(".mx-form select#id_departuretime_hour").prop("disabled",n),a(".mx-form select#id_departuretime_minute").prop("disabled",n),a(".mx-form select#id_departuretime_ampm").prop("disabled",n)}).fail(d.exception)}return function(){a(document).ready(e),a(".mx-form select#id_student").change(e),a('.mx-form div[data-groupname="type_select"]').change(e)}});