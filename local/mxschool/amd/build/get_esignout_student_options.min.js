define(["jquery","core/ajax","core/str","core/notification"],function(a,b,c,d){function e(){var e=a(".mx-form select#id_passengers").parent().parent(),f=a(".mx-form select#id_driver").parent().parent(),g=a(".mx-form input#id_type_other").parent().parent(),h=a(".mx-form fieldset#id_permissions");a(".mx-form input#id_type_select_Driver").prop("checked")||(e.hide(),e.next().hide()),a(".mx-form input#id_type_select_Passenger").prop("checked")?f.show():f.hide(),a(".mx-form input#id_type_select_Other").prop("checked")?g.show():g.hide();var i=b.call([{methodname:"local_mxschool_get_esignout_student_options",args:{userid:a(".mx-form select#id_student > option:selected").val()}}]);i[0].done(function(b){if(a(".mx-form input#id_type_select_Driver").prop("checked")&&(b.maydrivepassengers?(e.show(),e.next().hide()):(e.hide(),e.next().show())),a(".mx-form input#id_type_select_Passenger").prop("checked")&&"Any Driver"!==b.mayridewith){h.prev().hide(),h.show();var d=h.children().eq(1).children().eq(0),f=h.children().eq(1).children().eq(1);"Parent Permission"===b.mayridewith?(d.show(),f.hide()):"Specific Drivers"===b.mayridewith&&(d.hide(),a.when(c.get_string("esignout_form_specific_warning","local_mxschool")).done(function(a){f.children().eq(1).children().eq(0).text(a+" "+b.specificdrivers+"."),f.show()}))}else h.prev().show(),h.hide();var g=a(".mx-form select#id_driver");g.empty(),a.each(b.drivers,function(b,c){g.append(a("<option></option>").attr("value",c.esignoutid).text(c.name))})}).fail(d.exception)}return function(){a(document).ready(e),a('.mx-form div[data-groupname="type_select"]').change(e),a(".mx-form select#id_student").change(e)}});