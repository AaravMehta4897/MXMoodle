define(["jquery","core/ajax","core/str","core/notification","local_mxschool/locallib"],function(a,b,c,d,e){function f(){var f=b.call([{methodname:"local_mxschool_get_rooming_student_options",args:{userid:a(".mx-form select#id_student").val()}}]);f[0].done(function(b){e.updateSelect(a(".mx-form select#id_student"),b.students,"0"!==a('.mx-form input[name="id"]').val()),a(".mx-form fieldset#id_info div.form-control-static").text(b.dorm),a.when(c.get_string("form:select:default","local_mxschool")).done(function(c){function d(a){return a.value==k}b.roomtypes.unshift({value:0,text:c}),e.updateSelect(a(".mx-form select#id_roomtype"),b.roomtypes);var f=[{value:0,text:c}];b.gradedormmates.unshift(f[0]),b.dormmates.unshift(f[0]);for(var g=!0,h=1;h<=6;h++){var i=a(".mx-form select#id_dormmate"+h);e.updateSelect(i,h<=3?b.gradedormmates:b.dormmates);var j=i.parent().parent();g?j.show():j.hide();var k=i.val();0==k?g=!1:(b.gradedormmates.findIndex(d)>=0&&f.push(b.gradedormmates.splice(b.gradedormmates.findIndex(d),1)[0]),b.dormmates.splice(b.dormmates.findIndex(d),1))}var i=a(".mx-form select#id_roommate");e.updateSelect(a(".mx-form select#id_roommate"),f);var j=i.parent().parent();g?(j.prev().show(),j.show()):(j.prev().hide(),j.hide())})}).fail(d.exception)}return{setup:function(){a(document).ready(f),a(".mx-form select#id_student").change(f),a(".mx-form select#id_dormmate1").change(f),a(".mx-form select#id_dormmate2").change(f),a(".mx-form select#id_dormmate3").change(f),a(".mx-form select#id_dormmate4").change(f),a(".mx-form select#id_dormmate5").change(f),a(".mx-form select#id_dormmate6").change(f)}}});