define(["jquery","core/ajax","core/str","core/notification"],function(a,b,c,d){function e(){var e=b.call([{methodname:"local_mxschool_get_rooming_student_options",args:{userid:a(".mx-form select#id_student").val()}}]);e[0].done(function(b){var d=a(".mx-form select#id_student"),e=d.val(),f=a(".mx-form select#id_student > option[value="+e+"]").text();d.empty(),a.each(b.students,function(b,c){d.append(a("<option></option>").attr("value",c.userid).text(c.name))}),"0"!==a('.mx-form input[name="id"]').val()&&(a(".mx-form select#id_student > option[value="+e+"]").length||d.prepend(a("<option></option>").attr("value",e).text(f))),a(".mx-form select#id_student > option[value="+e+"]").length?d.val(e):d.change(),a(".mx-form fieldset#id_info div.form-control-static").text(b.dorm),a.when(c.get_string("form_select_default","local_mxschool")).done(function(c){function d(b,c){k.append(a("<option></option>").attr("value",c.userid).text(c.name))}function e(a){return a.userid==l}b.roomtypes.unshift({internalname:0,localizedname:c});var f=a(".mx-form select#id_roomtype"),g=f.val();f.empty(),a.each(b.roomtypes,function(b,c){f.append(a("<option></option>").attr("value",c.internalname).text(c.localizedname))}),a(".mx-form select#id_roomtype > option[value="+g+"]").length?f.val(g):f.change();var h=[{userid:0,name:c}];b.gradedormmates.unshift(h[0]),b.dormmates.unshift(h[0]);for(var i=!0,j=1;j<=6;j++){var k=a(".mx-form select#id_dormmate"+j),l=k.val();k.empty(),a.each(j<=3?b.gradedormmates:b.dormmates,d),a(".mx-form select#id_dormmate"+j+" > option[value="+l+"]").length?k.val(l):k.change();var m=k.parent().parent();i?m.show():m.hide(),0==l?i=!1:(b.gradedormmates.findIndex(e)>=0&&h.push(b.gradedormmates.splice(b.gradedormmates.findIndex(e),1)[0]),b.dormmates.splice(b.dormmates.findIndex(e),1))}var k=a(".mx-form select#id_roommate"),l=k.val(),m=k.parent().parent();k.empty(),a.each(h,d),a(".mx-form select#id_roommate > option[value="+l+"]").length?k.val(l):k.change(),i?(m.prev().show(),m.show()):(m.prev().hide(),m.hide())})}).fail(d.exception)}return function(){a(document).ready(e),a(".mx-form select#id_student").change(e),a(".mx-form select#id_dormmate1").change(e),a(".mx-form select#id_dormmate2").change(e),a(".mx-form select#id_dormmate3").change(e),a(".mx-form select#id_dormmate4").change(e),a(".mx-form select#id_dormmate5").change(e),a(".mx-form select#id_dormmate6").change(e)}});