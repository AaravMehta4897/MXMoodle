define(["jquery","core/ajax","core/str","core/notification"],function(a,b,c,d){function e(){var e=b.call([{methodname:"local_mxschool_get_rooming_student_options",args:{userid:a(".mx-form select#id_student").val()}}]);e[0].done(function(b){var d=a(".mx-form select#id_student"),e=d.val(),f=a(".mx-form select#id_student > option[value="+e+"]").text();d.empty(),a.each(b.students,function(b,c){d.append(a("<option></option>").attr("value",c.userid).text(c.name))}),"0"!==a('.mx-form input[name="id"]').val()&&(a(".mx-form select#id_student > option[value="+e+"]").length||d.prepend(a("<option></option>").attr("value",e).text(f))),a(".mx-form select#id_student > option[value="+e+"]").length?d.val(e):d.change(),a(".mx-form fieldset#id_info div.form-control-static").text(b.dorm),a.when(c.get_string("form_select_default","local_mxschool")).done(function(c){function d(b,c){i.append(a("<option></option>").attr("value",c.userid).text(c.name))}function e(a){return a.userid==j}var f=[{userid:0,name:c}];b.gradedormmates.unshift(f[0]),b.dormmates.unshift(f[0]);for(var g=!0,h=1;h<=6;h++){var i=a(".mx-form select#id_dormmate"+h),j=i.val();i.empty(),a.each(h<=3?b.gradedormmates:b.dormmates,d),a(".mx-form select#id_dormmate"+h+" > option[value="+j+"]").length?i.val(j):i.change();var k=i.parent().parent();g?k.show():k.hide(),0==j?g=!1:(b.gradedormmates.findIndex(e)>=0&&f.push(b.gradedormmates.splice(b.gradedormmates.findIndex(e),1)[0]),b.dormmates.splice(b.dormmates.findIndex(e),1))}var i=a(".mx-form select#id_roommate"),j=i.val(),k=i.parent().parent();i.empty(),a.each(f,d),a(".mx-form select#id_roommate > option[value="+j+"]").length?i.val(j):i.change(),g?(k.prev().show(),k.show()):(k.prev().hide(),k.hide())})}).fail(d.exception)}return function(){a(document).ready(e),a(".mx-form select#id_student").change(e),a(".mx-form select#id_dormmate1").change(e),a(".mx-form select#id_dormmate2").change(e),a(".mx-form select#id_dormmate3").change(e),a(".mx-form select#id_dormmate4").change(e),a(".mx-form select#id_dormmate5").change(e),a(".mx-form select#id_dormmate6").change(e)}});