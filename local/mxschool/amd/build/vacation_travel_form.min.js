define(["jquery","core/ajax","core/str","core/notification","local_mxschool/locallib"],function(a,b,c,d,e){function f(){var f=a(".mx-form fieldset#id_return").length,h=a('.mx-form div[data-groupname="dep_mxtransportation"] input:checked'),i=a('.mx-form div[data-groupname="dep_type"] input:checked'),j=a('.mx-form div[data-groupname="dep_site"] input:checked'),k=a('.mx-form div[data-groupname="ret_mxtransportation"] input:checked'),l=a('.mx-form div[data-groupname="ret_type"] input:checked'),m=a('.mx-form div[data-groupname="ret_site"] input:checked'),n=b.call([{methodname:"local_mxschool_get_vacation_travel_options",args:{departure:{mxtransportation:h.length?1==h.val():void 0,type:i.length?i.val():void 0,site:j.length?j.val():void 0},"return":{mxtransportation:f&&k.length?1==k.val():void 0,type:f&&l.length?l.val():void 0,site:m.length?m.val():void 0}}}]);n[0].done(function(b){e.updateSelect(a(".mx-form select#id_student"),b.students,"0"!==a('.mx-form input[name="id"]').val()),h.length?(e.updateRadio(a('.mx-form div[data-groupname="dep_type"] input'),b.departure.types),a('.mx-form div[data-groupname="dep_type"]').show()):a('.mx-form div[data-groupname="dep_type"]').hide();var d=a('.mx-form div[data-groupname="dep_site"]'),j=a(".mx-form input#id_dep_details").parent().parent(),m=a(".mx-form input#id_dep_carrier").parent().parent(),n=a(".mx-form input#id_dep_number").parent().parent(),o=a('.mx-form div[data-groupname="dep_variable"]'),p=a('.mx-form div[data-groupname="dep_international"]');if(i.length){var q=h.val(),r=i.val();if("1"===q){e.updateRadio(a('.mx-form div[data-groupname="dep_site"] input'),b.departure.sites);var s="vacation_travel_form_departure_dep_site"+("Plane"===r||"Train"===r?"_"+r:"");a.when(c.get_string(s,"local_mxschool")).done(function(a){d.children().eq(0).text(a),d.show()})}else d.hide();var t=a('.mx-form div[data-groupname="dep_site"] input:checked').val();if("Car"===r||"Non-MX Bus"===r||"1"===q&&"0"===t){var s="vacation_travel_form_departure_dep_details"+("Car"===r?"_"+r:"");a.when(c.get_string(s,"local_mxschool")).done(function(a){j.children().eq(0).text(a),j.show()})}else j.hide();"Plane"===r||"Train"===r||"Bus"===r?(a.when(c.get_string("vacation_travel_form_departure_dep_carrier_"+r,"local_mxschool")).done(function(a){m.children().eq(0).text(a),m.show()}),a.when(c.get_string("vacation_travel_form_departure_dep_number_"+r,"local_mxschool")).done(function(a){n.children().eq(0).text(a),n.show()})):(m.hide(),n.hide());var u="1"!==q||"Plane"!==r&&"Train"!==r&&"Bus"!==r?"":"_"+r;a.when(c.get_string("vacation_travel_form_departure_dep_variable"+u,"local_mxschool")).done(function(c){o.children().eq(0).text(c);var d=a(".mx-form select#id_dep_variable_time_hour"),e=a(".mx-form select#id_dep_variable_time_minute"),f=a(".mx-form select#id_dep_variable_time_ampm"),h=a(".mx-form select#id_dep_variable_date_day"),i=a(".mx-form select#id_dep_variable_date_month"),j=a(".mx-form select#id_dep_variable_date_year"),k=a(".mx-form a#id_dep_variable_date_calendar");b.departure["default"].year?(d.val(b.departure["default"].hour),e.val(b.departure["default"].minute),f.val("PM"===b.departure["default"].ampm?1:0),h.val(b.departure["default"].day),i.val(b.departure["default"].month),j.val(b.departure["default"].year),d.prop("disabled",!0),e.prop("disabled",!0),f.prop("disabled",!0),h.prop("disabled",!0),i.prop("disabled",!0),j.prop("disabled",!0),k.hide(),g()):(d.prop("disabled",!1),e.prop("disabled",!1),f.prop("disabled",!1),h.prop("disabled",!1),i.prop("disabled",!1),j.prop("disabled",!1),k.show()),o.show()}),"Plane"===r&&"1"===q?p.show():p.hide()}else d.hide(),j.hide(),m.hide(),n.hide(),o.hide(),p.hide();if(f){k.length?(e.updateRadio(a('.mx-form div[data-groupname="ret_type"] input'),b["return"].types),a('.mx-form div[data-groupname="ret_type"]').show()):a('.mx-form div[data-groupname="ret_type"]').hide();var v=a('.mx-form div[data-groupname="ret_site"]'),w=a(".mx-form input#id_ret_details").parent().parent(),x=a(".mx-form input#id_ret_carrier").parent().parent(),y=a(".mx-form input#id_ret_number").parent().parent(),z=a('.mx-form div[data-groupname="ret_variable"]'),A=a('.mx-form div[data-groupname="ret_international"]');if(l.length){var B=k.val(),C=l.val();if("1"===B){e.updateRadio(a('.mx-form div[data-groupname="ret_site"] input'),b["return"].sites);var s="vacation_travel_form_return_ret_site"+("Plane"===C||"Train"===C?"_"+C:"");a.when(c.get_string(s,"local_mxschool")).done(function(a){v.children().eq(0).text(a),v.show()})}else v.hide();var D=a('.mx-form div[data-groupname="ret_site"] input:checked').val();if("Car"===C||"Non-MX Bus"===C||"1"===B&&"0"===D){var s="vacation_travel_form_return_ret_details"+("Car"===C?"_"+C:"");a.when(c.get_string(s,"local_mxschool")).done(function(a){w.children().eq(0).text(a),w.show()})}else w.hide();"Plane"===C||"Train"===C||"Bus"===C?(a.when(c.get_string("vacation_travel_form_return_ret_carrier_"+C,"local_mxschool")).done(function(a){x.children().eq(0).text(a),x.show()}),a.when(c.get_string("vacation_travel_form_return_ret_number_"+C,"local_mxschool")).done(function(a){y.children().eq(0).text(a),y.show()})):(x.hide(),y.hide());var u="1"!==B||"Plane"!==C&&"Train"!==C&&"Bus"!==C?"":"_"+C;a.when(c.get_string("vacation_travel_form_return_ret_variable"+u,"local_mxschool")).done(function(c){z.children().eq(0).text(c);var d=a(".mx-form select#id_ret_variable_time_hour"),e=a(".mx-form select#id_ret_variable_time_minute"),f=a(".mx-form select#id_ret_variable_time_ampm"),h=a(".mx-form select#id_ret_variable_date_day"),i=a(".mx-form select#id_ret_variable_date_month"),j=a(".mx-form select#id_ret_variable_date_year"),k=a(".mx-form a#id_ret_variable_date_calendar");b["return"]["default"].year?(d.val(b["return"]["default"].hour),e.val(b["return"]["default"].minute),f.val(b["return"]["default"].ampm?1:0),h.val(b["return"]["default"].day),i.val(b["return"]["default"].month),j.val(b["return"]["default"].year),d.prop("disabled",!0),e.prop("disabled",!0),f.prop("disabled",!0),h.prop("disabled",!0),i.prop("disabled",!0),j.prop("disabled",!0),k.hide(),g()):(d.prop("disabled",!1),e.prop("disabled",!1),f.prop("disabled",!1),h.prop("disabled",!1),i.prop("disabled",!1),j.prop("disabled",!1),k.show()),z.show()}),"Plane"===C&&"1"===B?A.show():A.hide()}else v.hide(),w.hide(),x.hide(),y.hide(),z.hide(),A.hide()}}).fail(d.exception)}function g(){var b=a(".mx-form select#id_dep_variable_date_year"),c=a(".mx-form select#id_dep_variable_date_month"),d=a(".mx-form select#id_dep_variable_date_day"),e=new Date(b.val(),c.val()-1,d.val()),f=e.toLocaleDateString("en-US",{weekday:"long"}),g=a('.mx-form div[data-groupname="dep_variable_date"]');""!==a(g[0].previousSibling).text().trim()&&g[0].previousSibling.remove(),g.before("&nbsp;"+f+"&nbsp;");var h=a(".mx-form select#id_ret_variable_date_year"),i=a(".mx-form select#id_ret_variable_date_month"),j=a(".mx-form select#id_ret_variable_date_day"),k=new Date(h.val(),i.val()-1,j.val()),l=k.toLocaleDateString("en-US",{weekday:"long"}),m=a('.mx-form div[data-groupname="ret_variable_date"]');""!==a(m[0].previousSibling).text().trim()&&m[0].previousSibling.remove(),m.before("&nbsp;"+l+"&nbsp;")}return{setup:function(){a(document).ready(function(){f(),g()}),a('div[data-groupname="dep_mxtransportation"]').change(f),a('div[data-groupname="dep_type"]').change(f),a('div[data-groupname="dep_site"]').change(f),a('div[data-groupname="dep_variable_date"]').change(g),a("a#id_dep_variable_date_calendar").on("click",function(){setTimeout(function(){a("div#dateselector-calendar-panel td").on("click",function(){setTimeout(g,100)})},100)}),a(".mx-form fieldset#id_return").length&&(a('div[data-groupname="ret_mxtransportation"]').change(f),a('div[data-groupname="ret_type"]').change(f),a('div[data-groupname="ret_site"]').change(f),a('div[data-groupname="ret_variable_date"]').change(g),a("a#id_ret_variable_date_calendar").on("click",function(){setTimeout(function(){a("div#dateselector-calendar-panel td").on("click",function(){setTimeout(g,100)})},100)}))}}});