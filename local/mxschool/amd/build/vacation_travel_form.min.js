define(["jquery","core/ajax","core/str","core/notification","local_mxschool/locallib"],function(a,b,c,d,e){function f(){var f=a(".mx-form fieldset#id_return").length,g=a('.mx-form div[data-groupname="dep_mxtransportation"] input:checked'),h=a('.mx-form div[data-groupname="dep_type"] input:checked'),i=a('.mx-form div[data-groupname="ret_mxtransportation"] input:checked'),j=a('.mx-form div[data-groupname="ret_type"] input:checked'),k=b.call([{methodname:"local_mxschool_get_vacation_travel_options",args:{departure:{mxtransportation:g.length?1==g.val():void 0,type:h.length?h.val():void 0},"return":{mxtransportation:f&&i.length?1==i.val():void 0,type:f&&j.length?j.val():void 0}}}]);k[0].done(function(b){e.updateSelect(a(".mx-form select#id_student"),b.students,"0"!==a('.mx-form input[name="id"]').val()),g.length?(e.updateRadio(a('.mx-form div[data-groupname="dep_type"] input'),b.departure.types),a('.mx-form div[data-groupname="dep_type"]').show()):a('.mx-form div[data-groupname="dep_type"]').hide();var d=a('.mx-form div[data-groupname="dep_site"]'),k=a(".mx-form input#id_dep_details").parent().parent(),l=a(".mx-form input#id_dep_carrier").parent().parent(),m=a(".mx-form input#id_dep_number").parent().parent(),n=a('.mx-form div[data-groupname="dep_variable"]'),o=a('.mx-form div[data-groupname="dep_international"]');if(h.length){var p=g.val(),q=h.val();if("1"===p){e.updateRadio(a('.mx-form div[data-groupname="dep_site"] input'),b.departure.sites);var r="vacation_travel_form_departure_dep_site"+("Plane"===q||"Train"===q?"_"+q:"");a.when(c.get_string(r,"local_mxschool")).done(function(a){d.children().eq(0).text(a),d.show()})}else d.hide();var s=a('.mx-form div[data-groupname="dep_site"] input:checked').val();if("Car"===q||"Non-MX Bus"===q||"1"===p&&"0"===s){var r="vacation_travel_form_departure_dep_details"+("Car"===q?"_"+q:"");a.when(c.get_string(r,"local_mxschool")).done(function(a){k.children().eq(0).text(a),k.show()})}else k.hide();"Plane"===q||"Train"===q||"Bus"===q?(a.when(c.get_string("vacation_travel_form_departure_dep_carrier_"+q,"local_mxschool")).done(function(a){l.children().eq(0).text(a),l.show()}),a.when(c.get_string("vacation_travel_form_departure_dep_number_"+q,"local_mxschool")).done(function(a){m.children().eq(0).text(a),m.show()})):(l.hide(),m.hide());var t="1"!==p||"Plane"!==q&&"Train"!==q&&"Bus"!==q?"":"_"+q;a.when(c.get_string("vacation_travel_form_departure_dep_variable"+t,"local_mxschool")).done(function(a){n.children().eq(0).text(a),n.show()}),"Plane"===q&&"1"===p?o.show():o.hide()}else d.hide(),k.hide(),l.hide(),m.hide(),n.hide(),o.hide();if(f){i.length?(e.updateRadio(a('.mx-form div[data-groupname="ret_type"] input'),b["return"].types),a('.mx-form div[data-groupname="ret_type"]').show()):a('.mx-form div[data-groupname="ret_type"]').hide();var u=a('.mx-form div[data-groupname="ret_site"]'),v=a(".mx-form input#id_ret_details").parent().parent(),w=a(".mx-form input#id_ret_carrier").parent().parent(),x=a(".mx-form input#id_ret_number").parent().parent(),y=a('.mx-form div[data-groupname="ret_variable"]'),z=a('.mx-form div[data-groupname="ret_international"]');if(j.length){var A=i.val(),B=j.val();if("1"===A){e.updateRadio(a('.mx-form div[data-groupname="ret_site"] input'),b["return"].sites);var r="vacation_travel_form_return_ret_site"+("Plane"===B||"Train"===B?"_"+B:"");a.when(c.get_string(r,"local_mxschool")).done(function(a){u.children().eq(0).text(a),u.show()})}else u.hide();var C=a('.mx-form div[data-groupname="ret_site"] input:checked').val();if("Car"===B||"Non-MX Bus"===B||"1"===A&&"0"===C){var r="vacation_travel_form_return_ret_details"+("Car"===B?"_"+B:"");a.when(c.get_string(r,"local_mxschool")).done(function(a){v.children().eq(0).text(a),v.show()})}else v.hide();"Plane"===B||"Train"===B||"Bus"===B?(a.when(c.get_string("vacation_travel_form_return_ret_carrier_"+B,"local_mxschool")).done(function(a){w.children().eq(0).text(a),w.show()}),a.when(c.get_string("vacation_travel_form_return_ret_number_"+B,"local_mxschool")).done(function(a){x.children().eq(0).text(a),x.show()})):(w.hide(),x.hide());var t="1"!==A||"Plane"!==B&&"Train"!==B&&"Bus"!==B?"":"_"+B;a.when(c.get_string("vacation_travel_form_return_ret_variable"+t,"local_mxschool")).done(function(a){y.children().eq(0).text(a),y.show()}),"Plane"===B&&"1"===A?z.show():z.hide()}else u.hide(),v.hide(),w.hide(),x.hide(),y.hide(),z.hide()}}).fail(d.exception)}return function(){a(document).ready(f),a('div[data-groupname="dep_mxtransportation"]').change(f),a('div[data-groupname="dep_type"]').change(f),a('div[data-groupname="dep_site"]').change(f),a(".mx-form fieldset#id_return").length&&(a('div[data-groupname="ret_mxtransportation"]').change(f),a('div[data-groupname="ret_type"]').change(f),a('div[data-groupname="ret_site"]').change(f))}});