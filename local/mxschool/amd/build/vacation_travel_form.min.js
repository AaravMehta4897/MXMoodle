define(["jquery","core/ajax","core/str","core/notification","local_mxschool/locallib"],function(a,b,c,d,e){function f(){var c=a(".mx-form fieldset#id_return").length,f=a('.mx-form div[data-groupname="dep_mxtransportation"] input:checked'),h=a('.mx-form div[data-groupname="dep_type"] input:checked'),i=a('.mx-form div[data-groupname="dep_site"] input:checked'),j=a('.mx-form div[data-groupname="ret_mxtransportation"] input:checked'),k=a('.mx-form div[data-groupname="ret_type"] input:checked'),l=a('.mx-form div[data-groupname="ret_site"] input:checked'),m=b.call([{methodname:"local_mxschool_get_vacation_travel_options",args:{departure:{mxtransportation:f.length?1==f.val():void 0,type:h.length?h.val():void 0,site:i.length?i.val():void 0},"return":{mxtransportation:c&&j.length?1==j.val():void 0,type:c&&k.length?k.val():void 0,site:l.length?l.val():void 0}}}]);m[0].done(function(b){e.updateSelect(a(".mx-form select#id_student"),b.students,"0"!==a('.mx-form input[name="id"]').val()),g("departure",b.departure),c&&g("return",b["return"])}).fail(d.exception)}function g(b,d){var f=b.substring(0,3),g="vacation_travel:form:"+b+":"+f+"_",i=a('.mx-form div[data-groupname="'+f+'_mxtransportation"] input:checked'),j=a('.mx-form div[data-groupname="'+f+'_type"] input:checked');i.length?(e.updateRadio(a('.mx-form div[data-groupname="'+f+'_type"] input'),d.types),a('.mx-form div[data-groupname="'+f+'_type"]').show()):a('.mx-form div[data-groupname="'+f+'_type"]').hide();var k=a('.mx-form div[data-groupname="'+f+'_site"]'),l=a(".mx-form input#id_"+f+"_details").parent().parent(),m=a(".mx-form input#id_"+f+"_carrier").parent().parent(),n=a(".mx-form input#id_"+f+"_number").parent().parent(),o=a('.mx-form div[data-groupname="'+f+'_variable"]'),p=a('.mx-form div[data-groupname="'+f+'_international"]');if(j.length){var q=i.val(),r=j.val();if("1"===q){e.updateRadio(a('.mx-form div[data-groupname="'+f+'_site"] input'),d.sites);var s="Plane"===r||"Train"===r?":"+r:"";a.when(c.get_string(g+"site"+s,"local_mxschool")).done(function(a){k.children().eq(0).text(a),k.show()})}else k.hide();var t=a('.mx-form div[data-groupname="'+f+'_site"] input:checked').val();if("Car"===r||"Non-MX Bus"===r||"1"===q&&"0"===t){var s="Car"===r?":"+r:"";a.when(c.get_string(g+"details"+s,"local_mxschool")).done(function(a){l.children().eq(0).text(a),l.show()})}else l.hide();"Plane"===r||"Train"===r||"Bus"===r?(a.when(c.get_string(g+"carrier:"+r,"local_mxschool")).done(function(a){m.children().eq(0).text(a),m.show()}),a.when(c.get_string(g+"number:"+r,"local_mxschool")).done(function(a){n.children().eq(0).text(a),n.show()})):(m.hide(),n.hide());var s="1"!==q||"Plane"!==r&&"Train"!==r&&"Bus"!==r?"":":"+r;a.when(c.get_string(g+"variable"+s,"local_mxschool")).done(function(b){o.children().eq(0).text(b);var c=a(".mx-form select#id_"+f+"_variable_time_hour"),e=a(".mx-form select#id_"+f+"_variable_time_minute"),g=a(".mx-form select#id_"+f+"_variable_time_ampm"),i=a(".mx-form select#id_"+f+"_variable_date_day"),j=a(".mx-form select#id_"+f+"_variable_date_month"),k=a(".mx-form select#id_"+f+"_variable_date_year"),l=a(".mx-form a#id_"+f+"_variable_date_calendar");d["default"].year?(c.val(d["default"].hour),e.val(d["default"].minute),g.val("PM"===d["default"].ampm?1:0),i.val(d["default"].day),j.val(d["default"].month),k.val(d["default"].year),c.prop("disabled",!0),e.prop("disabled",!0),g.prop("disabled",!0),i.prop("disabled",!0),j.prop("disabled",!0),k.prop("disabled",!0),l.hide(),h(f)):(c.prop("disabled",!1),e.prop("disabled",!1),g.prop("disabled",!1),i.prop("disabled",!1),j.prop("disabled",!1),k.prop("disabled",!1),l.show()),o.show()}),"Plane"===r&&"1"===q?p.show():p.hide()}else k.hide(),l.hide(),m.hide(),n.hide(),o.hide(),p.hide()}function h(b){var c=a(".mx-form select#id_"+b+"_variable_date_year"),d=a(".mx-form select#id_"+b+"_variable_date_month"),e=a(".mx-form select#id_"+b+"_variable_date_day"),f=new Date(c.val(),d.val()-1,e.val()),g=f.toLocaleDateString("en-US",{weekday:"long"}),h=a('.mx-form div[data-groupname="'+b+'_variable_date"]');""!==a(h[0].previousSibling).text().trim()&&h[0].previousSibling.remove(),h.before("&nbsp;"+g+"&nbsp;")}return{setup:function(){a(document).ready(function(){f(),h("dep"),a(".mx-form fieldset#id_return").length&&h("ret")}),a('div[data-groupname="dep_mxtransportation"]').change(f),a('div[data-groupname="dep_type"]').change(f),a('div[data-groupname="dep_site"]').change(f),a('div[data-groupname="dep_variable_date"]').change(function(){h("dep")}),a("a#id_dep_variable_date_calendar").on("click",function(){setTimeout(function(){a("div#dateselector-calendar-panel td").on("click",function(){setTimeout(function(){h("dep")},100)})},100)}),a(".mx-form fieldset#id_return").length&&(a('div[data-groupname="ret_mxtransportation"]').change(f),a('div[data-groupname="ret_type"]').change(f),a('div[data-groupname="ret_site"]').change(f),a('div[data-groupname="ret_variable_date"]').change(function(){h("ret")}),a("a#id_ret_variable_date_calendar").on("click",function(){setTimeout(function(){a("div#dateselector-calendar-panel td").on("click",function(){setTimeout(function(){h("ret")},100)})},100)}))}}});