define(["jquery","core/ajax","core/str","core/notification","local_mxschool/locallib"],function(a,b,c,d,e){function f(){var f=a(".mx-form fieldset#id_return").length,g=a('.mx-form div[data-groupname="dep_mxtransportation"] input:checked'),h=a('.mx-form div[data-groupname="dep_type"] input:checked'),i=a('.mx-form div[data-groupname="dep_site"] input:checked'),j=a('.mx-form div[data-groupname="ret_mxtransportation"] input:checked'),k=a('.mx-form div[data-groupname="ret_type"] input:checked'),l=a('.mx-form div[data-groupname="ret_site"] input:checked'),m=b.call([{methodname:"local_mxschool_get_vacation_travel_options",args:{departure:{mxtransportation:g.length?1==g.val():void 0,type:h.length?h.val():void 0,site:i.length?i.val():void 0},"return":{mxtransportation:f&&j.length?1==j.val():void 0,type:f&&k.length?k.val():void 0,site:l.length?l.val():void 0}}}]);m[0].done(function(b){e.updateSelect(a(".mx-form select#id_student"),b.students,"0"!==a('.mx-form input[name="id"]').val()),g.length?(e.updateRadio(a('.mx-form div[data-groupname="dep_type"] input'),b.departure.types),a('.mx-form div[data-groupname="dep_type"]').show()):a('.mx-form div[data-groupname="dep_type"]').hide();var d=a('.mx-form div[data-groupname="dep_site"]'),i=a(".mx-form input#id_dep_details").parent().parent(),l=a(".mx-form input#id_dep_carrier").parent().parent(),m=a(".mx-form input#id_dep_number").parent().parent(),n=a('.mx-form div[data-groupname="dep_variable"]'),o=a('.mx-form div[data-groupname="dep_international"]');if(h.length){var p=g.val(),q=h.val();if("1"===p){e.updateRadio(a('.mx-form div[data-groupname="dep_site"] input'),b.departure.sites);var r="vacation_travel_form_departure_dep_site"+("Plane"===q||"Train"===q?"_"+q:"");a.when(c.get_string(r,"local_mxschool")).done(function(a){d.children().eq(0).text(a),d.show()})}else d.hide();var s=a('.mx-form div[data-groupname="dep_site"] input:checked').val();if("Car"===q||"Non-MX Bus"===q||"1"===p&&"0"===s){var r="vacation_travel_form_departure_dep_details"+("Car"===q?"_"+q:"");a.when(c.get_string(r,"local_mxschool")).done(function(a){i.children().eq(0).text(a),i.show()})}else i.hide();"Plane"===q||"Train"===q||"Bus"===q?(a.when(c.get_string("vacation_travel_form_departure_dep_carrier_"+q,"local_mxschool")).done(function(a){l.children().eq(0).text(a),l.show()}),a.when(c.get_string("vacation_travel_form_departure_dep_number_"+q,"local_mxschool")).done(function(a){m.children().eq(0).text(a),m.show()})):(l.hide(),m.hide());var t="1"!==p||"Plane"!==q&&"Train"!==q&&"Bus"!==q?"":"_"+q;a.when(c.get_string("vacation_travel_form_departure_dep_variable"+t,"local_mxschool")).done(function(c){n.children().eq(0).text(c);var d=a(".mx-form select#id_dep_variable_time_hour"),e=a(".mx-form select#id_dep_variable_time_minute"),f=a(".mx-form select#id_dep_variable_time_ampm"),g=a(".mx-form select#id_dep_variable_date_day"),h=a(".mx-form select#id_dep_variable_date_month"),i=a(".mx-form select#id_dep_variable_date_year"),j=a(".mx-form a#id_dep_variable_date_calendar");b.departure["default"].year?(d.val(b.departure["default"].hour),e.val(b.departure["default"].minute),f.val(b.departure["default"].ampm?1:0),g.val(b.departure["default"].day),h.val(b.departure["default"].month),i.val(b.departure["default"].year),d.prop("disabled",!0),e.prop("disabled",!0),f.prop("disabled",!0),g.prop("disabled",!0),h.prop("disabled",!0),i.prop("disabled",!0),j.hide()):(d.prop("disabled",!1),e.prop("disabled",!1),f.prop("disabled",!1),g.prop("disabled",!1),h.prop("disabled",!1),i.prop("disabled",!1),j.show()),n.show()}),"Plane"===q&&"1"===p?o.show():o.hide()}else d.hide(),i.hide(),l.hide(),m.hide(),n.hide(),o.hide();if(f){j.length?(e.updateRadio(a('.mx-form div[data-groupname="ret_type"] input'),b["return"].types),a('.mx-form div[data-groupname="ret_type"]').show()):a('.mx-form div[data-groupname="ret_type"]').hide();var u=a('.mx-form div[data-groupname="ret_site"]'),v=a(".mx-form input#id_ret_details").parent().parent(),w=a(".mx-form input#id_ret_carrier").parent().parent(),x=a(".mx-form input#id_ret_number").parent().parent(),y=a('.mx-form div[data-groupname="ret_variable"]'),z=a('.mx-form div[data-groupname="ret_international"]');if(k.length){var A=j.val(),B=k.val();if("1"===A){e.updateRadio(a('.mx-form div[data-groupname="ret_site"] input'),b["return"].sites);var r="vacation_travel_form_return_ret_site"+("Plane"===B||"Train"===B?"_"+B:"");a.when(c.get_string(r,"local_mxschool")).done(function(a){u.children().eq(0).text(a),u.show()})}else u.hide();var C=a('.mx-form div[data-groupname="ret_site"] input:checked').val();if("Car"===B||"Non-MX Bus"===B||"1"===A&&"0"===C){var r="vacation_travel_form_return_ret_details"+("Car"===B?"_"+B:"");a.when(c.get_string(r,"local_mxschool")).done(function(a){v.children().eq(0).text(a),v.show()})}else v.hide();"Plane"===B||"Train"===B||"Bus"===B?(a.when(c.get_string("vacation_travel_form_return_ret_carrier_"+B,"local_mxschool")).done(function(a){w.children().eq(0).text(a),w.show()}),a.when(c.get_string("vacation_travel_form_return_ret_number_"+B,"local_mxschool")).done(function(a){x.children().eq(0).text(a),x.show()})):(w.hide(),x.hide());var t="1"!==A||"Plane"!==B&&"Train"!==B&&"Bus"!==B?"":"_"+B;a.when(c.get_string("vacation_travel_form_return_ret_variable"+t,"local_mxschool")).done(function(c){y.children().eq(0).text(c);var d=a(".mx-form select#id_ret_variable_time_hour"),e=a(".mx-form select#id_ret_variable_time_minute"),f=a(".mx-form select#id_ret_variable_time_ampm"),g=a(".mx-form select#id_ret_variable_date_day"),h=a(".mx-form select#id_ret_variable_date_month"),i=a(".mx-form select#id_ret_variable_date_year"),j=a(".mx-form a#id_ret_variable_date_calendar");b["return"]["default"].year?(d.val(b["return"]["default"].hour),e.val(b["return"]["default"].minute),f.val(b["return"]["default"].ampm?1:0),g.val(b["return"]["default"].day),h.val(b["return"]["default"].month),i.val(b["return"]["default"].year),d.prop("disabled",!0),e.prop("disabled",!0),f.prop("disabled",!0),g.prop("disabled",!0),h.prop("disabled",!0),i.prop("disabled",!0),j.hide()):(d.prop("disabled",!1),e.prop("disabled",!1),f.prop("disabled",!1),g.prop("disabled",!1),h.prop("disabled",!1),i.prop("disabled",!1),j.show()),y.show()}),"Plane"===B&&"1"===A?z.show():z.hide()}else u.hide(),v.hide(),w.hide(),x.hide(),y.hide(),z.hide()}}).fail(d.exception)}return function(){a(document).ready(f),a('div[data-groupname="dep_mxtransportation"]').change(f),a('div[data-groupname="dep_type"]').change(f),a('div[data-groupname="dep_site"]').change(f),a(".mx-form fieldset#id_return").length&&(a('div[data-groupname="ret_mxtransportation"]').change(f),a('div[data-groupname="ret_type"]').change(f),a('div[data-groupname="ret_site"]').change(f))}});