define(["jquery","core/str","core/ajax","core/notification"],function(a,b,c,d){function e(e){var f=a(e.target),g=f.text();a.when(b.get_string("email_button:sending","local_mxschool")).done(function(a){f.text(a)});var h=c.call([{methodname:"local_mxschool_send_email",args:{emailclass:f.attr("name"),emailparams:{id:f.val()}}}]);h[0].done(function(c){var d="email_button:"+(c?"success":"failure");a.when(b.get_string(d,"local_mxschool")).done(function(a){f.text(a),setTimeout(function(){f.trigger("hideButton"),setTimeout(function(){f.text(g)},4e3)},1e3)})}).fail(d.exception)}function f(c){a.when(b.get_string("email_button:confirmation","local_mxschool")).done(function(a){confirm(a)&&e(c)})}return function(b,c,d,g){var h=a('button.mx-email-button[value="'+b+'"][name="'+c+'"]');if(h.click(d?f:e),g){h.on("showButton",function(b){a(b.target).show("slow")}),h.on("hideButton",function(b){a(b.target).hide("slow")});var i=h.parent().children("div.mx-checkbox").children().eq(0);i&&(i.on("checkboxEnabled",function(){h.trigger("showButton")}),i.on("checkboxDisabled",function(){h.trigger("hideButton")}))}}});