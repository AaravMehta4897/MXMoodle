define(["jquery","core/str","core/ajax","core/notification"],function(a,b,c,d){function e(){var e=a(this),f=e.text();a.when(b.get_string("email_button_sending","local_mxschool")).done(function(a){e.text(a)});var g=c.call([{methodname:"local_mxschool_send_email",args:{emailclass:e.attr("name"),emailparams:{id:e.val()}}}]);g[0].done(function(c){var d="email_button_send_"+(c?"success":"failure");a.when(b.get_string(d,"local_mxschool")).done(function(a){e.text(a),setTimeout(function(){e.trigger("hideButton"),setTimeout(function(){e.text(f)},4e3)},1e3)})}).fail(d.exception)}function f(){a(this).show("slow"),a(this).parent().children('span:contains(" ")').remove(),a(this).before(a("<span></span>").text(" "))}function g(){a(this).hide("slow"),a(this).parent().children('span:contains(" ")').remove()}return function(b,c,d){var h=a('button.mx-email-button[value="'+b+'"][name="'+c+'"]');if(h.click(e),d){h.on("showButton",f),h.on("hideButton",g);var i=h.parent().children("input.mx-checkbox");i&&(i.on("checkboxEnabled",function(){h.trigger("showButton")}),i.on("checkboxDisabled",function(){h.trigger("hideButton")}))}else h.show()}});