define(["jquery","core/ajax","core/str","core/notification"],function(a,b,c,d){function e(){var e=a(".mx-form fieldset#id_return").length,f=a('.mx-form div[data-groupname="dep_mxtransportation"] input:checked'),g=a('.mx-form div[data-groupname="dep_type"] input:checked'),h=a('.mx-form div[data-groupname="ret_mxtransportation"] input:checked'),i=a('.mx-form div[data-groupname="ret_type"] input:checked'),j=b.call([{methodname:"local_mxschool_get_vacation_travel_options",args:{departure:{mxtransportation:f.length?1==f.val():void 0,type:g.length?g.val():void 0},"return":{mxtransportation:e&&h.length?1==h.val():void 0,type:e&&i.length?i.val():void 0}}}]);j[0].done(function(b){var d=a(".mx-form select#id_student"),j=d.val(),k=a(".mx-form select#id_student > option[value="+j+"]").text();if(d.empty(),a.each(b.students,function(b,c){d.append(a("<option></option>").attr("value",c.userid).text(c.name))}),"0"!==a('.mx-form input[name="id"]').val()&&(a(".mx-form select#id_student > option[value="+j+"]").length||d.prepend(a("<option></option>").attr("value",j).text(k))),a(".mx-form select#id_student > option[value="+j+"]").length?d.val(j):d.change(),f.length){var l=a('.mx-form div[data-groupname="dep_type"] input');l.each(function(){var c=a(this),d=c.parent().parent().contents();b.departure.types.includes(c.val())?(c.parent().show(),d.eq(d.index(c.parent())+3).get(0).nodeValue=" "):(c.prop("checked")&&(c.prop("checked",!1),c.change()),c.parent().hide(),d.eq(d.index(c.parent())+3).get(0).nodeValue="")}),a('.mx-form div[data-groupname="dep_type"]').show()}else a('.mx-form div[data-groupname="dep_type"]').hide();var m=a('.mx-form div[data-groupname="dep_site"]'),n=a(".mx-form input#id_dep_details").parent().parent(),o=a(".mx-form input#id_dep_carrier").parent().parent(),p=a(".mx-form input#id_dep_number").parent().parent(),q=a('.mx-form div[data-groupname="dep_variable"]'),r=a('.mx-form div[data-groupname="dep_international"]');if(g.length){var s=f.val(),t=g.val();if("1"===s){var u=a('.mx-form div[data-groupname="dep_site"] input');u.each(function(){var c=a(this),d=c.parent().parent().contents();b.departure.sites.includes(c.val())?(c.parent().show(),d.eq(d.index(c.parent())+3).get(0).nodeValue=" "):(c.prop("checked")&&(c.prop("checked",!1),c.change()),c.parent().hide(),d.eq(d.index(c.parent())+3).get(0).nodeValue="")});var v="vacation_travel_form_departure_dep_site"+("Plane"===t||"Train"===t?"_"+t:"");a.when(c.get_string(v,"local_mxschool")).done(function(a){m.children().eq(0).text(a),m.show()})}else m.hide();var w=a('.mx-form div[data-groupname="dep_site"] input:checked').val();if("Car"===t||"Non-MX Bus"===t||"1"===s&&"0"===w){var v="vacation_travel_form_departure_dep_details"+("Car"===t?"_"+t:"");a.when(c.get_string(v,"local_mxschool")).done(function(a){n.children().eq(0).text(a),n.show()})}else n.hide();"Plane"===t||"Train"===t||"Bus"===t?(a.when(c.get_string("vacation_travel_form_departure_dep_carrier_"+t,"local_mxschool")).done(function(a){o.children().eq(0).text(a),o.show()}),a.when(c.get_string("vacation_travel_form_departure_dep_number_"+t,"local_mxschool")).done(function(a){p.children().eq(0).text(a),p.show()})):(o.hide(),p.hide());var x="1"!==s||"Plane"!==t&&"Train"!==t&&"Bus"!==t?"":"_"+t;a.when(c.get_string("vacation_travel_form_departure_dep_variable"+x,"local_mxschool")).done(function(a){q.children().eq(0).text(a),q.show()}),"Plane"===t&&"1"===s?r.show():r.hide()}else m.hide(),n.hide(),o.hide(),p.hide(),q.hide(),r.hide();if(e){if(h.length){var l=a('.mx-form div[data-groupname="ret_type"] input');l.each(function(){var c=a(this),d=c.parent().parent().contents();b["return"].types.includes(c.val())?(c.parent().show(),d.eq(d.index(c.parent())+3).get(0).nodeValue=" "):(c.prop("checked")&&(c.prop("checked",!1),c.change()),c.parent().hide(),d.eq(d.index(c.parent())+3).get(0).nodeValue="")}),a('.mx-form div[data-groupname="ret_type"]').show()}else a('.mx-form div[data-groupname="ret_type"]').hide();var y=a('.mx-form div[data-groupname="ret_site"]'),z=a(".mx-form input#id_ret_details").parent().parent(),A=a(".mx-form input#id_ret_carrier").parent().parent(),B=a(".mx-form input#id_ret_number").parent().parent(),C=a('.mx-form div[data-groupname="ret_variable"]'),D=a('.mx-form div[data-groupname="ret_international"]');if(i.length){var E=h.val(),F=i.val();if("1"===E){var u=a('.mx-form div[data-groupname="ret_site"] input');u.each(function(){var c=a(this),d=c.parent().parent().contents();b["return"].sites.includes(c.val())?(c.parent().show(),d.eq(d.index(c.parent())+3).get(0).nodeValue=" "):(c.prop("checked")&&(c.prop("checked",!1),c.change()),c.parent().hide(),d.eq(d.index(c.parent())+3).get(0).nodeValue="")});var v="vacation_travel_form_return_ret_site"+("Plane"===F||"Train"===F?"_"+F:"");a.when(c.get_string(v,"local_mxschool")).done(function(a){y.children().eq(0).text(a),y.show()})}else y.hide();var G=a('.mx-form div[data-groupname="ret_site"] input:checked').val();if("Car"===F||"Non-MX Bus"===F||"1"===E&&"0"===G){var v="vacation_travel_form_return_ret_details"+("Car"===F?"_"+F:"");a.when(c.get_string(v,"local_mxschool")).done(function(a){z.children().eq(0).text(a),z.show()})}else z.hide();"Plane"===F||"Train"===F||"Bus"===F?(a.when(c.get_string("vacation_travel_form_return_ret_carrier_"+F,"local_mxschool")).done(function(a){A.children().eq(0).text(a),A.show()}),a.when(c.get_string("vacation_travel_form_return_ret_number_"+F,"local_mxschool")).done(function(a){B.children().eq(0).text(a),B.show()})):(A.hide(),B.hide());var x="1"!==E||"Plane"!==F&&"Train"!==F&&"Bus"!==F?"":"_"+F;a.when(c.get_string("vacation_travel_form_return_ret_variable"+x,"local_mxschool")).done(function(a){C.children().eq(0).text(a),C.show()}),"Plane"===F&&"1"===E?D.show():D.hide()}else y.hide(),z.hide(),A.hide(),B.hide(),C.hide(),D.hide()}}).fail(d.exception)}return function(){a(document).ready(e),a('div[data-groupname="dep_mxtransportation"]').change(e),a('div[data-groupname="dep_type"]').change(e),a('div[data-groupname="dep_site"]').change(e),a(".mx-form fieldset#id_return").length&&(a('div[data-groupname="ret_mxtransportation"]').change(e),a('div[data-groupname="ret_type"]').change(e),a('div[data-groupname="ret_site"]').change(e))}});