define(["jquery","core/ajax","core/str","core/notification"],function(a,b,c,d){function e(){var e=a('.mx-form div[data-groupname="dep_mxtransportation"] input:checked'),f=a('.mx-form div[data-groupname="dep_type"] input:checked'),g=a('.mx-form div[data-groupname="ret_mxtransportation"] input:checked'),h=a('.mx-form div[data-groupname="ret_type"] input:checked'),i=b.call([{methodname:"local_mxschool_get_vacation_travel_options",args:{departure:{mxtransportation:e.length?1==e.val():void 0,type:f.length?f.val():void 0},"return":{mxtransportation:g.length?1==g.val():void 0,type:h.length?h.val():void 0}}}]);i[0].done(function(b){var d=a(".mx-form select#id_student"),i=d.val(),j=a(".mx-form select#id_student > option[value="+i+"]").text();if(d.empty(),a.each(b.students,function(b,c){d.append(a("<option></option>").attr("value",c.userid).text(c.name))}),"0"!==a('.mx-form input[name="id"]').val()&&(a(".mx-form select#id_student > option[value="+i+"]").length||d.prepend(a("<option></option>").attr("value",i).text(j))),a(".mx-form select#id_student > option[value="+i+"]").length?d.val(i):d.change(),e.length){var k=a('.mx-form div[data-groupname="dep_type"] input');k.each(function(){var c=a(this),d=c.parent().parent().contents();b.departure.types.includes(c.val())?(c.parent().show(),d.eq(d.index(c.parent())+3).get(0).nodeValue=" "):(c.prop("checked")&&(c.prop("checked",!1),c.change()),c.parent().hide(),d.eq(d.index(c.parent())+3).get(0).nodeValue="")}),a('.mx-form div[data-groupname="dep_type"]').show()}else a('.mx-form div[data-groupname="dep_type"]').hide();var l=a('.mx-form div[data-groupname="dep_site"]'),m=a(".mx-form input#id_dep_details").parent().parent(),n=a(".mx-form input#id_dep_carrier").parent().parent(),o=a(".mx-form input#id_dep_number").parent().parent(),p=a('.mx-form div[data-groupname="dep_transportation"]'),q=a('.mx-form div[data-groupname="dep_international"]');if(f.length){var r=e.val(),s=f.val();if("1"===r){var t=a('.mx-form div[data-groupname="dep_site"] input');t.each(function(){var c=a(this),d=c.parent().parent().contents();b.departure.sites.includes(c.val())?(c.parent().show(),d.eq(d.index(c.parent())+3).get(0).nodeValue=" "):(c.prop("checked")&&(c.prop("checked",!1),c.change()),c.parent().hide(),d.eq(d.index(c.parent())+3).get(0).nodeValue="")});var u="vacation_travel_form_departure_dep_site"+("Plane"===s||"Train"===s?"_"+s:"");a.when(c.get_string(u,"local_mxschool")).done(function(a){l.children().eq(0).text(a),l.show()})}else l.hide();var v=a('.mx-form div[data-groupname="dep_site"] input:checked').val();if("Car"===s||"Non-MX Bus"===s||"1"===r&&"0"===v){var u="vacation_travel_form_departure_dep_details"+("Car"===s?"_"+s:"");a.when(c.get_string(u,"local_mxschool")).done(function(a){m.children().eq(0).text(a),m.show()})}else m.hide();"Plane"===s||"Train"===s||"Bus"===s?(a.when(c.get_string("vacation_travel_form_departure_dep_carrier_"+s,"local_mxschool")).done(function(a){n.children().eq(0).text(a),n.show()}),a.when(c.get_string("vacation_travel_form_departure_dep_number_"+s,"local_mxschool")).done(function(a){o.children().eq(0).text(a),o.show()}),"1"===r?a.when(c.get_string("vacation_travel_form_departure_dep_transportation_"+s,"local_mxschool")).done(function(a){p.children().eq(0).text(a),p.show()}):p.hide()):(n.hide(),o.hide(),p.hide()),"Plane"===s&&"1"===r?q.show():q.hide()}else l.hide(),m.hide(),n.hide(),o.hide(),p.hide(),q.hide();if(g.length){var k=a('.mx-form div[data-groupname="ret_type"] input');k.each(function(){var c=a(this),d=c.parent().parent().contents();b["return"].types.includes(c.val())?(c.parent().show(),d.eq(d.index(c.parent())+3).get(0).nodeValue=" "):(c.prop("checked")&&(c.prop("checked",!1),c.change()),c.parent().hide(),d.eq(d.index(c.parent())+3).get(0).nodeValue="")}),a('.mx-form div[data-groupname="ret_type"]').show()}else a('.mx-form div[data-groupname="ret_type"]').hide();var w=a('.mx-form div[data-groupname="ret_site"]'),x=a(".mx-form input#id_ret_details").parent().parent(),y=a(".mx-form input#id_ret_carrier").parent().parent(),z=a(".mx-form input#id_ret_number").parent().parent(),A=a('.mx-form div[data-groupname="ret_transportation"]'),B=a('.mx-form div[data-groupname="ret_international"]');if(h.length){var C=g.val(),D=h.val();if("1"===C){var t=a('.mx-form div[data-groupname="ret_site"] input');t.each(function(){var c=a(this),d=c.parent().parent().contents();b["return"].sites.includes(c.val())?(c.parent().show(),d.eq(d.index(c.parent())+3).get(0).nodeValue=" "):(c.prop("checked")&&(c.prop("checked",!1),c.change()),c.parent().hide(),d.eq(d.index(c.parent())+3).get(0).nodeValue="")});var u="vacation_travel_form_return_ret_site"+("Plane"===D||"Train"===D?"_"+D:"");a.when(c.get_string(u,"local_mxschool")).done(function(a){w.children().eq(0).text(a),w.show()})}else w.hide();var E=a('.mx-form div[data-groupname="ret_site"] input:checked').val();if("Car"===D||"Non-MX Bus"===D||"1"===C&&"0"===E){var u="vacation_travel_form_return_ret_details"+("Car"===D?"_"+D:"");a.when(c.get_string(u,"local_mxschool")).done(function(a){x.children().eq(0).text(a),x.show()})}else x.hide();"Plane"===D||"Train"===D||"Bus"===D?(a.when(c.get_string("vacation_travel_form_return_ret_carrier_"+D,"local_mxschool")).done(function(a){y.children().eq(0).text(a),y.show()}),a.when(c.get_string("vacation_travel_form_return_ret_number_"+D,"local_mxschool")).done(function(a){z.children().eq(0).text(a),z.show()}),"1"===C?a.when(c.get_string("vacation_travel_form_return_ret_transportation_"+D,"local_mxschool")).done(function(a){A.children().eq(0).text(a),A.show()}):A.hide()):(y.hide(),z.hide(),A.hide()),"Plane"===D&&"1"===C?B.show():B.hide()}else w.hide(),x.hide(),y.hide(),z.hide(),A.hide(),B.hide()}).fail(d.exception)}return function(){a(document).ready(e),a('div[data-groupname="dep_mxtransportation"]').change(e),a('div[data-groupname="dep_type"]').change(e),a('div[data-groupname="dep_site"]').change(e),a('div[data-groupname="ret_mxtransportation"]').change(e),a('div[data-groupname="ret_type"]').change(e),a('div[data-groupname="ret_site"]').change(e)}});