define(["jquery","core/ajax","core/str","core/notification","local_mxschool/locallib"],function(a,b,c,d,e){function f(){a(".mx-form div#fitem_id_warning").children().eq(1).children().eq(0).addClass("text-warning"),a(".mx-form div#fitem_id_instructions").children().eq(1).children().eq(0).addClass("text-info")}function g(){var f=a(".mx-form input#id_keep_current_0"),g=a(".mx-form fieldset#id_options");f.prop("checked")?g.show():g.hide();var h=b.call([{methodname:"local_mxschool_get_advisor_selection_student_options",args:{userid:a(".mx-form select#id_student").val()}}]);h[0].done(function(b){e.updateSelect(a(".mx-form select#id_student"),b.students,"0"!==a('.mx-form input[name="id"]').val()),a(".mx-form fieldset#id_info div.form-control-static").eq(0).text(b.current.text);var d=a('.mx-form div[data-groupname="keep_current"]'),f=a(".mx-form input#id_keep_current_0"),g=a(".mx-form fieldset#id_info div.form-control-static").eq(1).parent().parent();b.closing?(d.hide(),f.prop("checked")||(f.prop("checked",!0),d.change()),g.show()):(g.hide(),d.show()),a.when(c.get_string("form:select:default","local_mxschool")).done(function(c){function d(a){return a.value==k}var f=b.available.findIndex(function(a){return a.value===b.current.value});f!==-1&&b.available.splice(f,1),b.available.unshift({value:0,text:c});for(var g=!0,h=1;h<=5;h++){var i=a(".mx-form select#id_option"+h);e.updateSelect(i,b.available);var j=i.parent().parent();g?j.show():j.hide();var k=i.val();0==k?g=!1:(b.available.splice(b.available.findIndex(d),1),k==b.current.value&&(g=!1)),1!==h||b.closing||b.available.splice(1,0,b.current)}})}).fail(d.exception)}return{setup:function(){a(document).ready(function(){f();var b=a(".mx-form fieldset#id_deans");"0"===a('.mx-form input[name="isstudent"]').val()?b.show():b.hide(),g()}),a(".mx-form select#id_student").change(g),a('.mx-form div[data-groupname="keep_current"]').change(g),a(".mx-form select#id_option1").change(g),a(".mx-form select#id_option2").change(g),a(".mx-form select#id_option3").change(g),a(".mx-form select#id_option4").change(g),a(".mx-form select#id_option5").change(g)}}});