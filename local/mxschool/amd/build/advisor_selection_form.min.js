define(["jquery","core/ajax","core/str","core/notification","local_mxschool/locallib"],function(a,b,c,d,e){function f(){var f=a(".mx-form input#id_keepcurrent_0"),g=a(".mx-form fieldset#id_options");f.prop("checked")?g.show():g.hide();var h=b.call([{methodname:"local_mxschool_get_advisor_selection_student_options",args:{userid:a(".mx-form select#id_student").val()}}]);h[0].done(function(b){e.updateSelect(a(".mx-form select#id_student"),b.students,"0"!==a('.mx-form input[name="id"]').val()),a(".mx-form fieldset#id_info div.form-control-static").eq(0).text(b.current.text);var d=a('.mx-form div[data-groupname="keepcurrent"]'),f=a(".mx-form input#id_keepcurrent_0"),g=a(".mx-form fieldset#id_info div.form-control-static").eq(1).parent().parent();b.closing?(d.hide(),f.prop("checked")||(f.prop("checked",!0),d.change()),g.show()):(g.hide(),d.show()),a.when(c.get_string("form_select_default","local_mxschool")).done(function(c){function d(a){return a.value==j}b.available.splice(b.available.findIndex(function(a){return a.value===b.current.value}),1),b.available.unshift({value:0,text:c});for(var f=!0,g=1;g<=5;g++){var h=a(".mx-form select#id_option"+g);e.updateSelect(h,b.available);var i=h.parent().parent();f?i.show():i.hide();var j=h.val();0==j?f=!1:(b.available.splice(b.available.findIndex(d),1),j==b.current.value&&(f=!1)),1!==g||b.closing||b.available.splice(1,0,b.current)}})}).fail(d.exception)}return function(){a(document).ready(function(){var b=a(".mx-form fieldset#id_deans");"0"===a('.mx-form input[name="isstudent"]').val()?b.show():b.hide(),f()}),a(".mx-form select#id_student").change(f),a('.mx-form div[data-groupname="keepcurrent"]').change(f),a(".mx-form select#id_option1").change(f),a(".mx-form select#id_option2").change(f),a(".mx-form select#id_option3").change(f),a(".mx-form select#id_option4").change(f),a(".mx-form select#id_option5").change(f)}});