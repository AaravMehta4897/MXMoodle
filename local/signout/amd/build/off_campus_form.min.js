define(["jquery","core/ajax","core/str","core/notification","local_mxschool/locallib"],function(a,b,c,d,e){function f(){var f=b.call([{methodname:"local_signout_get_off_campus_student_options",args:{userid:a(".mx-form select#id_student").val(),typeid:a(".mx-form select#id_type_select").val()}}]);f[0].done(function(b){a.when(c.get_string("form:select:default","local_mxschool"),c.get_string("off_campus_form_type_select_other","local_signout")).done(function(c,d){b.types.unshift({value:0,text:c}),b.types.push({value:-1,text:d}),e.updateSelect(a(".mx-form select#id_type_select"),b.types)});var d=a(".mx-form fieldset#id_permissions");d.hide(),d.next().show();var f=d.children().eq(1).children().eq(0);!b.passengerwarning||"passenger"!==b.type&&a(".mx-form select#id_type_select").val()!=-1?f.hide():(d.next().hide(),f.children().eq(1).children().eq(0).text(b.passengerwarning),f.show(),d.show());var g=d.children().eq(1).children().eq(1);!b.ridesharewarning||"rideshare"!==b.type&&a(".mx-form select#id_type_select").val()!=-1?g.hide():(d.next().hide(),g.children().eq(1).children().eq(0).text(b.ridesharewarning),g.show(),d.show());var h=d.children().eq(1).children().eq(2);b.typewarning?(d.next().hide(),h.children().eq(1).children().eq(0).text(b.typewarning),h.show(),d.show()):h.hide();var i=a(".mx-form select#id_passengers").parent().parent();"driver"===b.type?b.maydrivepassengers?(i.next().hide(),i.show(),e.updateMultiSelect(a(".mx-form select#id_passengers"),b.passengers)):(i.hide(),i.next().show()):(i.hide(),i.next().hide());var j=a(".mx-form select#id_driver").parent().parent();"passenger"===b.type?(j.prev().show(),j.show(),a.when(c.get_string("form:select:default","local_mxschool")).done(function(c){b.drivers.unshift({value:0,text:c}),e.updateSelect(a(".mx-form select#id_driver"),b.drivers,!0)}),a(".mx-form input#id_destination").prop("disabled",!0),a(".mx-form select#id_departure_time_hour").prop("disabled",!0),a(".mx-form select#id_departure_time_minute").prop("disabled",!0),a(".mx-form select#id_departure_time_ampm").prop("disabled",!0)):(j.prev().hide(),j.hide(),a(".mx-form input#id_destination").prop("disabled",!1),a(".mx-form select#id_departure_time_hour").prop("disabled",!1),a(".mx-form select#id_departure_time_minute").prop("disabled",!1),a(".mx-form select#id_departure_time_ampm").prop("disabled",!1));var k=a(".mx-form select#id_approver").parent().parent();b.type||a(".mx-form select#id_type_select").val()==-1?k.show():k.hide()}).fail(d.exception)}function g(){var c=b.call([{methodname:"local_signout_get_off_campus_driver_details",args:{offcampusid:parseInt(a(".mx-form select#id_driver").val())}}]);c[0].done(function(b){a(".mx-form input#id_destination").val(b.destination),a(".mx-form select#id_departure_time_hour").val(b.departurehour),a(".mx-form select#id_departure_time_minute").val(b.departureminute),a(".mx-form select#id_departure_time_ampm").val(b.departureampm?1:0)}).fail(function(){a(".mx-form input#id_destination").val(function(){return this.defaultValue}),a(".mx-form select#id_departure_time_hour > option").prop("selected",function(){return this.defaultSelected}),a(".mx-form select#id_departure_time_minute > option").prop("selected",function(){return this.defaultSelected}),a(".mx-form select#id_departure_time_ampm > option").prop("selected",function(){return this.defaultSelected})})}return{setup:function(){a(document).ready(function(){f(),g()}),a(".mx-form select#id_student").change(f),a(".mx-form select#id_type_select").change(f),a(".mx-form select#id_driver").change(g)}}});